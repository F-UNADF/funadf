.breadcrumbs
  .page-header
    %h1 Mes votes

.content.mt-3
  .container-fluid
    .card
      .card-header
        %strong Liste des bulletins de votes

      .card-body
        .alert.alert-info
          Voici la liste des campagne de votes pour lesquelles vous ou vos églises sont membres.


        .table-responsive
          %table.table.table-striped.table-sm
            %thead
              %tr
                %th Structure concernée
                %th Bulletin
                %th

            - @campaigns.each do |campaign|

              - @presidences.each_with_index do |s, index|

                - if campaign.structure.is_member?(s)
                  - if campaign.structure.member_can_vote?(s) && !campaign.has_already_vote?(s)
                    // MEMBRE DE L'ASSOC, CAN_VOTE
                    %tr
                      %td= campaign.structure_name
                      %td= campaign.name
                      %td
                        - if campaign.opened?
                          = link_to campaign_path(campaign.id), class: 'btn btn-sm btn-primary' do
                            Commencer le vote
                            = icon 'arrow-right'
                        - else
                          .badge.badge-warning
                            Les votes ne sont pas encore ouverts

                    - break

                  - elsif !campaign.structure.member_can_vote?(s)
                    // MEMBRE DE L'ASSOC, MAIS CANT_VOTE
                    %tr
                      %td= campaign.structure_name
                      %td= campaign.name
                      %td
                        .alert.alert-danger.mb-0
                          %b= "Présidence de <b>#{s.name}</b> (#{s.town})".html_safe
                          %br
                          = campaign.structure.member_cant_vote_note_friendly(s)

                    - break


                - elsif campaign.structure_can_vote?(s, false) && !campaign.has_already_vote?(s)
                  // NON MEMBRE, CAN VOTE
                  %tr
                    %td= campaign.structure_name
                    %td= campaign.name
                    %td
                      - if campaign.opened?
                        = link_to campaign_path(campaign.id), class: 'btn btn-sm btn-primary' do
                          Commencer le vote
                          = icon 'arrow-right'
                      - else
                        .badge.badge-warning
                          Les votes ne sont pas encore ouverts
                  - break


              - if campaign.structure.is_member?(@user)
                - if campaign.structure.member_can_vote?(@user) && campaign.user_can_vote?(@user) && !campaign.has_already_vote?(@user)
                  // MEMBRE DE L'ASSOC, CAN_VOTE
                  %tr
                    %td= campaign.structure_name
                    %td= campaign.name
                    %td
                      - if campaign.opened?
                        = link_to campaign_path(campaign.id), class: 'btn btn-sm btn-primary' do
                          Commencer le vote
                          = icon 'arrow-right'
                      - else
                        .badge.badge-warning
                          Les votes ne sont pas encore ouverts


                - elsif !campaign.structure.member_can_vote?(@user)

                  // MEMBRE DE L'ASSOC, MAIS CANT_VOTE
                  %tr
                    %td= campaign.structure_name
                    %td= campaign.name
                    %td
                      .alert.alert-danger.mb-0
                        = campaign.structure.member_cant_vote_note_friendly(@user)

              - elsif campaign.user_can_vote?(@user, false) && !campaign.has_already_vote?(@user)
                // NON MEMBRE, CAN VOTE
                %tr
                  %td= campaign.structure_name
                  %td= campaign.name
                  %td
                    - if campaign.opened?
                      = link_to campaign_path(campaign.id), class: 'btn btn-sm btn-primary' do
                        Commencer le vote
                        = icon 'arrow-right'
                    - else
                      .badge.badge-warning
                        Les votes ne sont pas encore ouverts








